{"ast":null,"code":"/*\nThis file is part of web3.js.\n\nweb3.js is free software: you can redistribute it and/or modify\nit under the terms of the GNU Lesser General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nweb3.js is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Lesser General Public License for more details.\n\nYou should have received a copy of the GNU Lesser General Public License\nalong with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar _a;\nimport { OperationTimeoutError } from 'web3-errors';\n/**\n * The class is a simple implementation of a deferred promise with optional timeout functionality,\n * which can be useful when dealing with asynchronous tasks.\n *\n */\nexport class Web3DeferredPromise {\n  /**\n   *\n   * @param timeout - (optional) The timeout in milliseconds.\n   * @param eagerStart - (optional) If true, the timer starts as soon as the promise is created.\n   * @param timeoutMessage - (optional) The message to include in the timeout erro that is thrown when the promise times out.\n   */\n  constructor({\n    timeout,\n    eagerStart,\n    timeoutMessage\n  } = {\n    timeout: 0,\n    eagerStart: false,\n    timeoutMessage: 'DeferredPromise timed out'\n  }) {\n    // public tag to treat object as promise by different libs\n    // eslint-disable-next-line @typescript-eslint/prefer-as-const\n    this[_a] = 'Promise';\n    this._state = 'pending';\n    this._promise = new Promise((resolve, reject) => {\n      this._resolve = resolve;\n      this._reject = reject;\n    });\n    this._timeoutMessage = timeoutMessage;\n    this._timeoutInterval = timeout;\n    if (eagerStart) {\n      this.startTimer();\n    }\n  }\n  /**\n   * Returns the current state of the promise.\n   * @returns 'pending' | 'fulfilled' | 'rejected'\n   */\n  get state() {\n    return this._state;\n  }\n  /**\n   *\n   * @param onfulfilled - (optional) The callback to execute when the promise is fulfilled.\n   * @param onrejected  - (optional) The callback to execute when the promise is rejected.\n   * @returns\n   */\n  then(onfulfilled, onrejected) {\n    return __awaiter(this, void 0, void 0, function* () {\n      return this._promise.then(onfulfilled, onrejected);\n    });\n  }\n  /**\n   *\n   * @param onrejected - (optional) The callback to execute when the promise is rejected.\n   * @returns\n   */\n  catch(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  onrejected) {\n    return __awaiter(this, void 0, void 0, function* () {\n      return this._promise.catch(onrejected);\n    });\n  }\n  /**\n   *\n   * @param onfinally - (optional) The callback to execute when the promise is settled (fulfilled or rejected).\n   * @returns\n   */\n  finally(onfinally) {\n    return __awaiter(this, void 0, void 0, function* () {\n      return this._promise.finally(onfinally);\n    });\n  }\n  /**\n   * Resolves the current promise.\n   * @param value - The value to resolve the promise with.\n   */\n  resolve(value) {\n    this._resolve(value);\n    this._state = 'fulfilled';\n    this._clearTimeout();\n  }\n  /**\n   * Rejects the current promise.\n   * @param reason - The reason to reject the promise with.\n   */\n  reject(reason) {\n    this._reject(reason);\n    this._state = 'rejected';\n    this._clearTimeout();\n  }\n  /**\n   * Starts the timeout timer for the promise.\n   */\n  startTimer() {\n    if (this._timeoutInterval && this._timeoutInterval > 0) {\n      this._timeoutId = setTimeout(this._checkTimeout.bind(this), this._timeoutInterval);\n    }\n  }\n  _checkTimeout() {\n    if (this._state === 'pending' && this._timeoutId) {\n      this.reject(new OperationTimeoutError(this._timeoutMessage));\n    }\n  }\n  _clearTimeout() {\n    if (this._timeoutId) {\n      clearTimeout(this._timeoutId);\n    }\n  }\n}\n_a = Symbol.toStringTag;","map":{"version":3,"names":["OperationTimeoutError","Web3DeferredPromise","constructor","timeout","eagerStart","timeoutMessage","_a","_state","_promise","Promise","resolve","reject","_resolve","_reject","_timeoutMessage","_timeoutInterval","startTimer","state","then","onfulfilled","onrejected","catch","finally","onfinally","value","_clearTimeout","reason","_timeoutId","setTimeout","_checkTimeout","bind","clearTimeout","Symbol","toStringTag"],"sources":["../../src/web3_deferred_promise.ts"],"sourcesContent":[null],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiBA,SAASA,qBAAqB,QAAQ,aAAa;AAInD;;;;;AAKA,OAAM,MAAOC,mBAAmB;EAa/B;;;;;;EAMAC,YACC;IACCC,OAAO;IACPC,UAAU;IACVC;EAAc,IACuD;IACrEF,OAAO,EAAE,CAAC;IACVC,UAAU,EAAE,KAAK;IACjBC,cAAc,EAAE;GAChB;IA3BF;IACA;IACO,KAAAC,EAAA,CAAoB,GAAc,SAAS;IAK1C,KAAAC,MAAM,GAAyC,SAAS;IAsB/D,IAAI,CAACC,QAAQ,GAAG,IAAIC,OAAO,CAAI,CAACC,OAAO,EAAEC,MAAM,KAAI;MAClD,IAAI,CAACC,QAAQ,GAAGF,OAAO;MACvB,IAAI,CAACG,OAAO,GAAGF,MAAM;IACtB,CAAC,CAAC;IAEF,IAAI,CAACG,eAAe,GAAGT,cAAc;IACrC,IAAI,CAACU,gBAAgB,GAAGZ,OAAO;IAE/B,IAAIC,UAAU,EAAE;MACf,IAAI,CAACY,UAAU,EAAE;;EAEnB;EACA;;;;EAIA,IAAWC,KAAKA,CAAA;IACf,OAAO,IAAI,CAACV,MAAM;EACnB;EACA;;;;;;EAMaW,IAAIA,CAChBC,WAA4D,EAC5DC,UAAkE;;MAElE,OAAO,IAAI,CAACZ,QAAQ,CAACU,IAAI,CAACC,WAAW,EAAEC,UAAU,CAAC;IACnD,CAAC;;EACD;;;;;EAKaC,KAAKA;EACjB;EACAD,UAA4D;;MAE5D,OAAO,IAAI,CAACZ,QAAQ,CAACa,KAAK,CAACD,UAAU,CAAC;IACvC,CAAC;;EAED;;;;;EAKaE,OAAOA,CAACC,SAAoC;;MACxD,OAAO,IAAI,CAACf,QAAQ,CAACc,OAAO,CAACC,SAAS,CAAC;IACxC,CAAC;;EAED;;;;EAIOb,OAAOA,CAACc,KAAyB;IACvC,IAAI,CAACZ,QAAQ,CAACY,KAAK,CAAC;IACpB,IAAI,CAACjB,MAAM,GAAG,WAAW;IACzB,IAAI,CAACkB,aAAa,EAAE;EACrB;EAEA;;;;EAIOd,MAAMA,CAACe,MAAgB;IAC7B,IAAI,CAACb,OAAO,CAACa,MAAM,CAAC;IACpB,IAAI,CAACnB,MAAM,GAAG,UAAU;IACxB,IAAI,CAACkB,aAAa,EAAE;EACrB;EAEA;;;EAGOT,UAAUA,CAAA;IAChB,IAAI,IAAI,CAACD,gBAAgB,IAAI,IAAI,CAACA,gBAAgB,GAAG,CAAC,EAAE;MACvD,IAAI,CAACY,UAAU,GAAGC,UAAU,CAAC,IAAI,CAACC,aAAa,CAACC,IAAI,CAAC,IAAI,CAAC,EAAE,IAAI,CAACf,gBAAgB,CAAC;;EAEpF;EAEQc,aAAaA,CAAA;IACpB,IAAI,IAAI,CAACtB,MAAM,KAAK,SAAS,IAAI,IAAI,CAACoB,UAAU,EAAE;MACjD,IAAI,CAAChB,MAAM,CAAC,IAAIX,qBAAqB,CAAC,IAAI,CAACc,eAAe,CAAC,CAAC;;EAE9D;EAEQW,aAAaA,CAAA;IACpB,IAAI,IAAI,CAACE,UAAU,EAAE;MACpBI,YAAY,CAAC,IAAI,CAACJ,UAAU,CAAC;;EAE/B;;KAtHQK,MAAM,CAACC,WAAW","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}