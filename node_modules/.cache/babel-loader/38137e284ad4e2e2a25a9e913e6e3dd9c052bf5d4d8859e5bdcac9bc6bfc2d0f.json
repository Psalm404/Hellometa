{"ast":null,"code":"/*\nThis file is part of web3.js.\n\nweb3.js is free software: you can redistribute it and/or modify\nit under the terms of the GNU Lesser General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nweb3.js is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Lesser General Public License for more details.\n\nYou should have received a copy of the GNU Lesser General Public License\nalong with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nimport { Web3Context } from 'web3-core';\nimport { ENSNetworkNotSyncedError, ENSUnsupportedNetworkError } from 'web3-errors';\nimport { isSyncing } from 'web3-eth';\nimport { getId } from 'web3-net';\nimport { DEFAULT_RETURN_FORMAT, FMT_NUMBER } from 'web3-types';\nimport { networkIds, registryAddresses } from './config.js';\nimport { Registry } from './registry.js';\nimport { Resolver } from './resolver.js';\n/**\n * This class is designed to interact with the ENS system on the Ethereum blockchain.\n* For using ENS package, first install Web3 package using: `npm i web3` or `yarn add web3` based on your package manager, after that ENS features can be used as mentioned in following snippet.\n* ```ts\n*\n* import { Web3 } from 'web3';\n*\n* const web3 = new Web3('https://127.0.0.1:4545');\n*\n* console.log(await web3.eth.ens.getAddress('ethereum.eth'))\n* ```\n* For using individual package install `web3-eth-ens` packages using: `npm i web3-eth-ens` or `yarn add web3-eth-ens`. This is more efficient approach for building lightweight applications.\n*\n* ```ts\n*import { ENS } from 'web3-eth-ens';\n*\n* const ens = new ENS(undefined,'https://127.0.0.1:4545');\n*\n* console.log(await ens.getAddress('vitalik.eth'));\n* ```\n*/\nexport class ENS extends Web3Context {\n  /**\n   * Use to create an instance of ENS\n   * @param registryAddr - (Optional) The address of the ENS registry (default: mainnet registry address)\n   * @param provider - (Optional) The provider to use for the ENS instance\n   * @example\n   * ```ts\n   * const ens = new ENS(\n   * \t\"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e\",\n   * \t\"http://localhost:8545\"\n   * );\n   *\n   * console.log( ens.defaultChain);\n   * > mainnet\n   * ```\n   */\n  constructor(registryAddr, provider) {\n    super(provider !== null && provider !== void 0 ? provider : '');\n    this.registryAddress = registryAddr !== null && registryAddr !== void 0 ? registryAddr : registryAddresses.main; // will default to main registry address\n    this._registry = new Registry(this.getContextObject(), registryAddr);\n    this._resolver = new Resolver(this._registry);\n  }\n  /**\n   * Returns the Resolver by the given address\n   * @param name - The name of the ENS domain\n   * @returns - An contract instance of the resolver\n   *\n   * @example\n   * ```ts\n   * const resolver = await ens.getResolver('resolver');\n   *\n   * console.log(resolver.options.address);\n   * > '0x1234567890123456789012345678901234567890'\n   * ```\n   */\n  getResolver(name) {\n    return __awaiter(this, void 0, void 0, function* () {\n      return this._registry.getResolver(name);\n    });\n  }\n  /**\n   * Returns true if the record exists\n   * @param name - The ENS name\n   * @returns - Returns `true` if node exists in this ENS registry. This will return `false` for records that are in the legacy ENS registry but have not yet been migrated to the new one.\n   * @example\n   * ```ts\n   * const exists = await web3.eth.ens.recordExists('ethereum.eth');\n   * ```\n   */\n  recordExists(name) {\n    return __awaiter(this, void 0, void 0, function* () {\n      return this._registry.recordExists(name);\n    });\n  }\n  /**\n   * Returns the caching TTL (time-to-live) of an ENS name.\n   * @param name - The ENS name\n   * @returns - Returns the caching TTL (time-to-live) of a name.\n   * @example\n   * ```ts\n   * const owner = await web3.eth.ens.getTTL('ethereum.eth');\n   * ```\n   */\n  getTTL(name) {\n    return __awaiter(this, void 0, void 0, function* () {\n      return this._registry.getTTL(name);\n    });\n  }\n  /**\n   * Returns the owner by the given name and current configured or detected Registry\n   * @param name - The ENS name\n   * @returns - Returns the address of the owner of the name.\n   * @example\n   * ```ts\n   * const owner = await web3.eth.ens.getOwner('ethereum.eth');\n   * ```\n   */\n  getOwner(name) {\n    return __awaiter(this, void 0, void 0, function* () {\n      return this._registry.getOwner(name);\n    });\n  }\n  /**\n   * Resolves an ENS name to an Ethereum address.\n   * @param ENSName - The ENS name to resolve\n   * @param coinType - (Optional) The coin type, defaults to 60 (ETH)\n   * @returns - The Ethereum address of the given name\n   * ```ts\n   * const address = await web3.eth.ens.getAddress('ethereum.eth');\n   * console.log(address);\n   * > '0xfB6916095ca1df60bB79Ce92cE3Ea74c37c5d359'\n   * ```\n   */\n  getAddress(ENSName, coinType = 60) {\n    return __awaiter(this, void 0, void 0, function* () {\n      return this._resolver.getAddress(ENSName, coinType);\n    });\n  }\n  /**\n   * ERC-634 - Returns the text content stored in the resolver for the specified key.\n   * @param ENSName - The ENS name to resolve\n   * @param key - The key to resolve https://github.com/ethereum/ercs/blob/master/ERCS/erc-634.md#global-keys\n   * @returns - The value content stored in the resolver for the specified key\n   */\n  getText(ENSName, key) {\n    return __awaiter(this, void 0, void 0, function* () {\n      return this._resolver.getText(ENSName, key);\n    });\n  }\n  /**\n   * Resolves the name of an ENS node.\n   * @param ENSName - The node to resolve\n   * @returns - The name\n   */\n  getName(ENSName) {\n    return __awaiter(this, void 0, void 0, function* () {\n      return this._resolver.getName(ENSName);\n    });\n  }\n  /**\n   * Returns the X and Y coordinates of the curve point for the public key.\n   * @param ENSName - The ENS name\n   * @returns - The X and Y coordinates of the curve point for the public key\n   * @example\n   * ```ts\n   * const key = await web3.eth.ens.getPubkey('ethereum.eth');\n   * console.log(key);\n   * > {\n   * \"0\": \"0x0000000000000000000000000000000000000000000000000000000000000000\",\n   * \"1\": \"0x0000000000000000000000000000000000000000000000000000000000000000\",\n   * \"x\": \"0x0000000000000000000000000000000000000000000000000000000000000000\",\n   * \"y\": \"0x0000000000000000000000000000000000000000000000000000000000000000\"\n   * }\n   * ```\n   */\n  getPubkey(ENSName) {\n    return __awaiter(this, void 0, void 0, function* () {\n      return this._resolver.getPubkey(ENSName);\n    });\n  }\n  /**\n   * Returns the content hash object associated with an ENS node.\n   * @param ENSName - The ENS name\n   * @returns - The content hash object associated with an ENS node\n   * @example\n   * ```ts\n   * const hash = await web3.eth.ens.getContenthash('ethereum.eth');\n   * console.log(hash);\n   * > 'QmaEBknbGT4bTQiQoe2VNgBJbRfygQGktnaW5TbuKixjYL'\n   * ```\n   */\n  getContenthash(ENSName) {\n    return __awaiter(this, void 0, void 0, function* () {\n      return this._resolver.getContenthash(ENSName);\n    });\n  }\n  /**\n   * Checks if the current used network is synced and looks for ENS support there.\n   * Throws an error if not.\n   * @returns - The address of the ENS registry if the network has been detected successfully\n   * @example\n   * ```ts\n   * console.log(await web3.eth.ens.checkNetwork());\n   * > '0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e'\n   * ```\n   */\n  checkNetwork() {\n    return __awaiter(this, void 0, void 0, function* () {\n      const now = Date.now() / 1000;\n      if (!this._lastSyncCheck || now - this._lastSyncCheck > 3600) {\n        const syncInfo = yield isSyncing(this);\n        if (!(typeof syncInfo === 'boolean' && !syncInfo)) {\n          throw new ENSNetworkNotSyncedError();\n        }\n        this._lastSyncCheck = now;\n      }\n      if (this._detectedAddress) {\n        return this._detectedAddress;\n      }\n      const networkType = yield getId(this, Object.assign(Object.assign({}, DEFAULT_RETURN_FORMAT), {\n        number: FMT_NUMBER.HEX\n      })); // get the network from provider\n      const addr = registryAddresses[networkIds[networkType]];\n      if (typeof addr === 'undefined') {\n        throw new ENSUnsupportedNetworkError(networkType);\n      }\n      this._detectedAddress = addr;\n      return this._detectedAddress;\n    });\n  }\n  /**\n   * Returns true if the related Resolver does support the given signature or interfaceId.\n   * @param ENSName - The ENS name\n   * @param interfaceId - The signature of the function or the interfaceId as described in the ENS documentation\n   * @returns - `true` if the related Resolver does support the given signature or interfaceId.\n   * @example\n   * ```ts\n   * const supports = await web3.eth.ens.supportsInterface('ethereum.eth', 'addr(bytes32');\n   * console.log(supports);\n   * > true\n   * ```\n   */\n  supportsInterface(ENSName, interfaceId) {\n    return __awaiter(this, void 0, void 0, function* () {\n      return this._resolver.supportsInterface(ENSName, interfaceId);\n    });\n  }\n  /**\n   * @returns - Returns all events that can be emitted by the ENS registry.\n   */\n  get events() {\n    return this._registry.events;\n  }\n  /**\n   * Sets the address of an ENS name in his resolver.\n   * @param name - The ENS name\n   * @param address - The address to set\n   * @param txConfig - (Optional) The transaction config\n   * @returns - The transaction receipt\n   * ```ts\n   * const receipt = await ens.setAddress('web3js.eth','0xe2597eb05cf9a87eb1309e86750c903ec38e527e');\n   *```\n   */\n  setAddress(name, address, txConfig) {\n    return __awaiter(this, void 0, void 0, function* () {\n      return this._resolver.setAddress(name, address, txConfig);\n    });\n  }\n}","map":{"version":3,"names":["Web3Context","ENSNetworkNotSyncedError","ENSUnsupportedNetworkError","isSyncing","getId","DEFAULT_RETURN_FORMAT","FMT_NUMBER","networkIds","registryAddresses","Registry","Resolver","ENS","constructor","registryAddr","provider","registryAddress","main","_registry","getContextObject","_resolver","getResolver","name","recordExists","getTTL","getOwner","getAddress","ENSName","coinType","getText","key","getName","getPubkey","getContenthash","checkNetwork","now","Date","_lastSyncCheck","syncInfo","_detectedAddress","networkType","Object","assign","number","HEX","addr","supportsInterface","interfaceId","events","setAddress","address","txConfig"],"sources":["../../src/ens.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}