{"ast":null,"code":"/*\nThis file is part of web3.js.\n\nweb3.js is free software: you can redistribute it and/or modify\nit under the terms of the GNU Lesser General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nweb3.js is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Lesser General Public License for more details.\n\nYou should have received a copy of the GNU Lesser General Public License\nalong with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\nimport { format } from 'web3-utils';\nimport { DEFAULT_RETURN_FORMAT } from 'web3-types';\nimport { decodeLog } from 'web3-eth-abi';\nimport { logSchema } from '../schemas.js';\nimport { ALL_EVENTS } from '../constants.js';\nexport const decodeEventABI = (event, data, jsonInterface, returnFormat = DEFAULT_RETURN_FORMAT) => {\n  var _a, _b, _c, _d, _e;\n  let modifiedEvent = Object.assign({}, event);\n  const result = format(logSchema, data, returnFormat);\n  // if allEvents get the right event\n  if ([ALL_EVENTS, 'allEvents'].includes(modifiedEvent.name)) {\n    const matchedEvent = jsonInterface.find(j => j.signature === data.topics[0]);\n    if (matchedEvent) {\n      modifiedEvent = matchedEvent;\n    } else {\n      modifiedEvent = {\n        anonymous: true\n      };\n    }\n  }\n  // create empty inputs if none are present (e.g. anonymous events on allEvents)\n  modifiedEvent.inputs = (_b = (_a = modifiedEvent.inputs) !== null && _a !== void 0 ? _a : event.inputs) !== null && _b !== void 0 ? _b : [];\n  // Handle case where an event signature shadows the current ABI with non-identical\n  // arg indexing. If # of topics doesn't match, event is anon.\n  if (!modifiedEvent.anonymous) {\n    let indexedInputs = 0;\n    ((_c = modifiedEvent.inputs) !== null && _c !== void 0 ? _c : []).forEach(input => {\n      if (input.indexed) {\n        indexedInputs += 1;\n      }\n    });\n    if (indexedInputs > 0 && (data === null || data === void 0 ? void 0 : data.topics) && (data === null || data === void 0 ? void 0 : data.topics.length) !== indexedInputs + 1) {\n      // checks if event is anonymous\n      modifiedEvent = Object.assign(Object.assign({}, modifiedEvent), {\n        anonymous: true,\n        inputs: []\n      });\n    }\n  }\n  const argTopics = modifiedEvent.anonymous ? data.topics : ((_d = data.topics) !== null && _d !== void 0 ? _d : []).slice(1);\n  return Object.assign(Object.assign({}, result), {\n    returnValues: decodeLog([...((_e = modifiedEvent.inputs) !== null && _e !== void 0 ? _e : [])], data.data, argTopics),\n    event: modifiedEvent.name,\n    signature: modifiedEvent.anonymous || !data.topics || data.topics.length === 0 || !data.topics[0] ? undefined : data.topics[0],\n    raw: {\n      data: data.data,\n      topics: data.topics\n    }\n  });\n};","map":{"version":3,"names":["format","DEFAULT_RETURN_FORMAT","decodeLog","logSchema","ALL_EVENTS","decodeEventABI","event","data","jsonInterface","returnFormat","modifiedEvent","Object","assign","result","includes","name","matchedEvent","find","j","signature","topics","anonymous","inputs","_b","_a","indexedInputs","_c","forEach","input","indexed","length","argTopics","_d","slice","returnValues","_e","undefined","raw"],"sources":["../../../src/utils/decoding.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}