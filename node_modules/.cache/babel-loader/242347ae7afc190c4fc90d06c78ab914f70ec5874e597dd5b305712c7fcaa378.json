{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { InvalidResponseError } from 'web3-errors';\nexport class ChunkResponseParser {\n  constructor(eventEmitter, autoReconnect) {\n    this.eventEmitter = eventEmitter;\n    this.autoReconnect = autoReconnect;\n    this.chunkTimeout = 1000 * 15;\n  }\n  clearQueues() {\n    if (typeof this._clearQueues === 'function') {\n      this._clearQueues();\n    }\n  }\n  onError(clearQueues) {\n    this._clearQueues = clearQueues;\n  }\n  parseResponse(data) {\n    const returnValues = [];\n    // DE-CHUNKER\n    const dechunkedData = data.replace(/\\}[\\n\\r]?\\{/g, '}|--|{') // }{\n    .replace(/\\}\\][\\n\\r]?\\[\\{/g, '}]|--|[{') // }][{\n    .replace(/\\}[\\n\\r]?\\[\\{/g, '}|--|[{') // }[{\n    .replace(/\\}\\][\\n\\r]?\\{/g, '}]|--|{') // }]{\n    .split('|--|');\n    dechunkedData.forEach(_chunkData => {\n      // prepend the last chunk\n      let chunkData = _chunkData;\n      if (this.lastChunk) {\n        chunkData = this.lastChunk + chunkData;\n      }\n      let result;\n      try {\n        result = JSON.parse(chunkData);\n      } catch (e) {\n        this.lastChunk = chunkData;\n        // start timeout to cancel all requests\n        if (this.lastChunkTimeout) {\n          clearTimeout(this.lastChunkTimeout);\n        }\n        this.lastChunkTimeout = setTimeout(() => {\n          if (this.autoReconnect) return;\n          this.clearQueues();\n          this.eventEmitter.emit('error', new InvalidResponseError({\n            id: 1,\n            jsonrpc: '2.0',\n            error: {\n              code: 2,\n              message: 'Chunk timeout'\n            }\n          }));\n        }, this.chunkTimeout);\n        return;\n      }\n      // cancel timeout and set chunk to null\n      clearTimeout(this.lastChunkTimeout);\n      this.lastChunk = undefined;\n      if (result) returnValues.push(result);\n    });\n    return returnValues;\n  }\n}","map":{"version":3,"names":["InvalidResponseError","ChunkResponseParser","constructor","eventEmitter","autoReconnect","chunkTimeout","clearQueues","_clearQueues","onError","parseResponse","data","returnValues","dechunkedData","replace","split","forEach","_chunkData","chunkData","lastChunk","result","JSON","parse","e","lastChunkTimeout","clearTimeout","setTimeout","emit","id","jsonrpc","error","code","message","undefined","push"],"sources":["../../src/chunk_response_parser.ts"],"sourcesContent":[null],"mappings":";AAiBA,SAASA,oBAAoB,QAAQ,aAAa;AAIlD,OAAM,MAAOC,mBAAmB;EAQ/BC,YAAmBC,YAA0B,EAAEC,aAAsB;IACpE,IAAI,CAACD,YAAY,GAAGA,YAAY;IAChC,IAAI,CAACC,aAAa,GAAGA,aAAa;IAClC,IAAI,CAACC,YAAY,GAAG,IAAI,GAAG,EAAE;EAC9B;EACQC,WAAWA,CAAA;IAClB,IAAI,OAAO,IAAI,CAACC,YAAY,KAAK,UAAU,EAAE;MAC5C,IAAI,CAACA,YAAY,EAAE;;EAErB;EAEOC,OAAOA,CAACF,WAAwB;IACtC,IAAI,CAACC,YAAY,GAAGD,WAAW;EAChC;EAEOG,aAAaA,CAACC,IAAY;IAChC,MAAMC,YAAY,GAAsB,EAAE;IAE1C;IACA,MAAMC,aAAa,GAAGF,IAAI,CACxBG,OAAO,CAAC,cAAc,EAAE,QAAQ,CAAC,CAAC;IAAA,CAClCA,OAAO,CAAC,kBAAkB,EAAE,UAAU,CAAC,CAAC;IAAA,CACxCA,OAAO,CAAC,gBAAgB,EAAE,SAAS,CAAC,CAAC;IAAA,CACrCA,OAAO,CAAC,gBAAgB,EAAE,SAAS,CAAC,CAAC;IAAA,CACrCC,KAAK,CAAC,MAAM,CAAC;IAEfF,aAAa,CAACG,OAAO,CAACC,UAAU,IAAG;MAClC;MACA,IAAIC,SAAS,GAAGD,UAAU;MAC1B,IAAI,IAAI,CAACE,SAAS,EAAE;QACnBD,SAAS,GAAG,IAAI,CAACC,SAAS,GAAGD,SAAS;;MAGvC,IAAIE,MAAM;MAEV,IAAI;QACHA,MAAM,GAAGC,IAAI,CAACC,KAAK,CAACJ,SAAS,CAA+B;OAC5D,CAAC,OAAOK,CAAC,EAAE;QACX,IAAI,CAACJ,SAAS,GAAGD,SAAS;QAE1B;QACA,IAAI,IAAI,CAACM,gBAAgB,EAAE;UAC1BC,YAAY,CAAC,IAAI,CAACD,gBAAgB,CAAC;;QAGpC,IAAI,CAACA,gBAAgB,GAAGE,UAAU,CAAC,MAAK;UACvC,IAAI,IAAI,CAACrB,aAAa,EAAE;UACxB,IAAI,CAACE,WAAW,EAAE;UAClB,IAAI,CAACH,YAAY,CAACuB,IAAI,CACrB,OAAO,EACP,IAAI1B,oBAAoB,CAAC;YACxB2B,EAAE,EAAE,CAAC;YACLC,OAAO,EAAE,KAAK;YACdC,KAAK,EAAE;cAAEC,IAAI,EAAE,CAAC;cAAEC,OAAO,EAAE;YAAe;WAC1C,CAAC,CACF;QACF,CAAC,EAAE,IAAI,CAAC1B,YAAY,CAAC;QACrB;;MAGD;MACAmB,YAAY,CAAC,IAAI,CAACD,gBAAgB,CAAC;MACnC,IAAI,CAACL,SAAS,GAAGc,SAAS;MAE1B,IAAIb,MAAM,EAAER,YAAY,CAACsB,IAAI,CAACd,MAAM,CAAC;IACtC,CAAC,CAAC;IAEF,OAAOR,YAAY;EACpB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}