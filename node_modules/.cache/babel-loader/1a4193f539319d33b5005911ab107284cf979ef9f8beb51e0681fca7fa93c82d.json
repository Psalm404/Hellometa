{"ast":null,"code":"import axios from 'axios';\nexport default {\n  /* eslint-disable */\n  mounted() {\n    console.log('account:', localStorage.getItem('account'));\n    // this.getExchangeRate();\n  },\n  data() {\n    return {\n      tip: \" 交易中，请稍后......\",\n      loading: true,\n      rate: null,\n      price: 0,\n      urlContent: null,\n      isLoading: false,\n      out_trade_no: null,\n      drawer: false,\n      showBackButton: false\n    };\n  },\n  methods: {\n    close() {\n      this.isLoading = false;\n      this.tip = \" 交易中，请稍后......\";\n      this.showBackButton = true;\n    },\n    getExchangeRate() {\n      const apiBaseUrl = process.env.VUE_APP_BACKEND_BASE_URL;\n      axios.get(`${apiBaseUrl}/getExchangeRate`).then(res => {\n        console.log(res);\n        if (res.data.code === 200) {\n          console.log(res.data.rates);\n          this.CNYToUSD = res.data.rates.CNYToUSD;\n          this.rate = `人民币到美元:  ${this.CNYToUSD}`;\n          this.loading = false;\n        } else {\n          this.loading = false;\n          this.rate = '获取汇率失败';\n        }\n        console.log(this.CNYToUSD);\n      }).catch(e => {\n        console.log(e);\n      });\n    },\n    selectPrice(price) {\n      this.price = price;\n    },\n    requirePayment() {\n      console.log('account:', localStorage.getItem('account'));\n      const apiBaseUrl = process.env.VUE_APP_BACKEND_BASE_URL;\n      const intervalId = setInterval(() => {\n        axios.post(`${apiBaseUrl}/queryPayment`, {\n          account: localStorage.getItem('account'),\n          out_trade_no: this.out_trade_no\n        }).then(res => {\n          console.log(res.data.status);\n          if (res.data.code === 10001) {\n            this.tip = \"交易成功\";\n            this.showBackButton = true;\n            clearInterval(intervalId);\n            this.$message({\n              type: 'success',\n              message: '交易成功'\n            });\n          } else if (res.data.code === 20002) {} else if (res.data.code === 30003) {\n            this.isLoading = false;\n            this.$message({\n              type: 'error',\n              message: '未付款，交易关闭'\n            });\n          }\n        }).catch(error => {\n          console.error(\"请求失败\", error);\n        });\n      }, 2000); // 每2秒调用一次\n    },\n    beforeDestroy() {\n      clearInterval(intervalId); // 确保组件销毁时清理定时任务\n    },\n    submitOrder() {\n      this.out_trade_no = new Date().getTime();\n      if (this.price === 0) {\n        this.$message({\n          type: \"error\",\n          message: \"请选择充值数额\"\n        });\n        return;\n      }\n      let data = {\n        out_trade_no: this.out_trade_no,\n        total_amount: this.price,\n        subject: '充值'\n      };\n      console.log('submits');\n      const apiBaseUrl = process.env.VUE_APP_BACKEND_BASE_URL;\n      axios.post(`${apiBaseUrl}/payment`, data).then(res => {\n        this.isLoading = true;\n        this.urlContent = res.data.url;\n        console.log(this.urlContent);\n        window.open(this.urlContent, '_blank');\n        this.requirePayment();\n      }).catch(e => {\n        console.log(e);\n      });\n    }\n  }\n};","map":{"version":3,"names":["axios","mounted","console","log","localStorage","getItem","data","tip","loading","rate","price","urlContent","isLoading","out_trade_no","drawer","showBackButton","methods","close","getExchangeRate","apiBaseUrl","process","env","VUE_APP_BACKEND_BASE_URL","get","then","res","code","rates","CNYToUSD","catch","e","selectPrice","requirePayment","intervalId","setInterval","post","account","status","clearInterval","$message","type","message","error","beforeDestroy","submitOrder","Date","getTime","total_amount","subject","url","window","open"],"sources":["src/components/gasRecharge.vue"],"sourcesContent":["<template>\r\n<div class=\"gasRecharge-container\">\r\n    <div class=\"content\" style=\"height:100vh; width: 100vw\">\r\n        <div v-if=\"isLoading\" class=\"overlay\">\r\n            <div class=\"overlay-content\">\r\n                {{tip}}\r\n            </div>\r\n            <div>  <el-button id=\"backBT\" style=\"z-index:10001\" v-show=\"showBackButton\" @click=\"close\"> 返回充值 </el-button></div>\r\n          \r\n        </div>\r\n        <div ref=\"formDiv\"> </div>\r\n        <div class=\"gasRecharge-guideBox\">\r\n            <div style=\"display: flex; gap:50px;\">\r\n                <div class=\"gasRecharge-title\">\r\n                    燃料充值\r\n                </div>\r\n                <el-breadcrumb separator-class=\"el-icon-arrow-right\" style=\"margin-top:13px;\">\r\n                    <el-breadcrumb-item :to=\"{ path: '/myGas' }\">燃料管理</el-breadcrumb-item>\r\n                    <el-breadcrumb-item>燃料充值</el-breadcrumb-item>\r\n                </el-breadcrumb>\r\n            </div>\r\n            <a @click=\"drawer = true\" style=\"align-self:self-start;\">\r\n                <i class=\"el-icon-question\" style=\"display:contents;\"></i>\r\n                我该如何使用燃料充值？</a>\r\n        </div>\r\n        <div class=\"gasRecharge-box\">\r\n            <div style=\"align-self: self-start; font-weight:bold\"> 燃料数量(单位:ETH) </div>\r\n            <div class=\"gasRecharge-priceBox\">\r\n                <el-button class=\"priceBT\" type=\"primary\" plain size=\"small\" @click=\"selectPrice(0.1)\"> 0.1 ETH </el-button>\r\n                <el-button class=\"priceBT\" type=\"primary\" plain size=\"small\" @click=\"selectPrice(1)\"> 1 ETH </el-button>\r\n                <el-button class=\"priceBT\" type=\"primary\" plain size=\"small\" @click=\"selectPrice(5)\"> 5 ETH </el-button>\r\n                <el-button class=\"priceBT\" type=\"primary\" plain size=\"small\" @click=\"selectPrice(10)\"> 10 ETH </el-button>\r\n                <el-button class=\"priceBT\" type=\"primary\" plain size=\"small\" @click=\"selectPrice(50)\"> 50 ETH </el-button>\r\n            </div>\r\n            <div style=\"display: flex; flex-direction: column; margin-top:15px \">\r\n                <div style=\"align-self: self-start; font-weight:bold;\">价目表</div>\r\n                <div style=\"align-self: self-start; color:red; font-weight:bold;\"> 该汇率并非真实汇率，使用支付宝沙箱模拟交易环境，不涉及真实钱财交易。 </div>\r\n                <br />\r\n                <div style=\"align-self: center; font-weight:bold; font-size:19px;\"> 1 ETH = 1,000,000,000,000,000,000（1e18） WEI </div>\r\n                <div style=\"align-self: center; font-weight:bold; font-size:19px;\"> 1 RMB = 1 ETH </div>\r\n                <!-- <div v-loading=\"loading\" style=\"height: 40px\"> {{rate}} </div> -->\r\n            </div>\r\n        </div>\r\n        <div class=\"gasRecharge-currentPrice\">\r\n            <div style=\"align-self: self-start; font-weight:bold\"> 当前配置 </div>\r\n            <el-divider></el-divider>\r\n            <div style=\"display: flex; flex-direction: column; \">\r\n                <div style=\"display: flex;\">\r\n                    <div style=\"flex:1\">燃料数量</div>\r\n                    <div style=\"align-self: flex-end; flex:1; font-weight:bold; font-size:19px;\"> {{price}} </div>\r\n                </div>\r\n                <div style=\"display:flex\">\r\n                    <div style=\"flex:1; margin-top:20px\">配置费用</div>\r\n                    <div style=\"align-self: flex-end; flex:1; color:red; font-size:19px; font-weight:bold\"> ￥{{price}} </div>\r\n                </div>\r\n                <el-divider></el-divider>\r\n                <div style=\"margin-top:10px;\">\r\n                    <el-button type=\"primary\" size=\"small\" style=\"width:180px;\" @click=\"submitOrder()\"> 提交订单 </el-button>\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <el-drawer size=\"40%\" :visible.sync=\"drawer\" :with-header=\"false\">\r\n        <div style=\"font-size:22px; font-weight:bold; color:black; margin-top:20px;\">我该如何使用燃料充值?</div>\r\n        <div style=\"margin:20px;\">\r\n            <div style=\"display:flex; flex-direction: column; align-items: flex-start; gap:10px;\">\r\n                <div style=\"font-weight:bold\">一、下载沙箱版支付宝 </div>\r\n                <div style=\"font-weight:bold\">二、 支付流程 </div>\r\n                <div style=\"font-weight:bold\">三、支付常见问题 </div>\r\n            </div>\r\n            <div style=\"margin-top:20px; font-weight:bold; font-size:large; text-align: start;\"> 一、下载沙箱版支付宝 </div>\r\n            <br />\r\n            <div style=\"text-align: start\">&emsp;&emsp;支付宝沙箱是支付宝提供的一个模拟环境, 不会影响到真实支付宝账户和资金。对于本项目的充值系统，用户需要下载手机版支付宝沙箱进行模拟支付。</div>\r\n            <div style=\"text-align: start\">&emsp;&emsp;下载地址: <a href=\"https://open.alipay.com/develop/sandbox/tool/alipayclint\" target=\"_blank\"> https://open.alipay.com/develop/sandbox/tool/alipayclint</a></div>\r\n            <div style=\"text-align: start\">&emsp;&emsp;下载完毕后，在“沙箱账号”页面查看支付宝提供的账号和密码，在登录界面使用沙箱账号即可成功登录。 </div>\r\n            <div style=\"text-align: start; margin:10px\">\r\n                <el-image :src=\"require('@/assets/alipay1.png') \"></el-image>\r\n            </div>\r\n            <br/>\r\n            <div style=\"margin-top:20px; font-weight:bold; font-size:large; text-align: start;\"> 二、 支付流程 </div>\r\n            <br/>\r\n            <div style=\"text-align: start\">&emsp;&emsp;1. 选择要充值的金额，点击提交订单。 </div>\r\n            <div style=\"text-align: start\">&emsp;&emsp;2. 等待支付宝页面加载完毕，用支付宝沙箱版扫描二维码或填写账号密码支付。建议使用扫码支付。 </div>\r\n            <div style=\"text-align: start; margin:10px\">\r\n                <el-image :src=\"require('@/assets/alipay2.png') \"></el-image>\r\n            </div>\r\n            <div style=\"text-align: start\">&emsp;&emsp;3. 在手机上输入支付密码（默认为11111），检测到成功支付后点击按钮即可返回充值页面。 </div>\r\n            <br/>\r\n            <div style=\"margin-top:20px; font-weight:bold; font-size:large; text-align: start;\"> 三、支付常见问题 </div>\r\n            <br/>\r\n            <div style=\"text-align: start; font-weight:bold;\">&emsp;&emsp;1. 页面加载慢/加载失败怎么办？ </div>\r\n            <div style=\"text-align: start\">&emsp;&emsp;受支付宝沙箱系统稳定性影响，可能存在支付页面加载较慢、系统繁忙、交易失败等问题，耐心等待一会儿，多刷新几次，不要急着关闭页面。 </div>\r\n            <div style=\"text-align: start; font-weight:bold;\">&emsp;&emsp;2. 会对真实支付宝账户产生影响吗？ </div>\r\n            <div style=\"text-align: start\">&emsp;&emsp;不会。 </div>\r\n            \r\n        </div>\r\n    </el-drawer>\r\n</div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios';\r\nexport default {\r\n    /* eslint-disable */\r\n    mounted() {\r\n        console.log('account:', localStorage.getItem('account'))\r\n        // this.getExchangeRate();\r\n    },\r\n    data() {\r\n        return {\r\n            tip: \" 交易中，请稍后......\",\r\n            loading: true,\r\n            rate: null,\r\n            price: 0,\r\n            urlContent: null,\r\n            isLoading: false,\r\n            out_trade_no: null,\r\n            drawer: false,\r\n            showBackButton: false,\r\n        };\r\n    },\r\n    methods: {\r\n        close() {\r\n            this.isLoading = false;\r\n            this.tip = \" 交易中，请稍后......\"\r\n            this.showBackButton = true;\r\n        },\r\n        getExchangeRate() {\r\n            const apiBaseUrl = process.env.VUE_APP_BACKEND_BASE_URL;\r\n            axios.get(`${apiBaseUrl}/getExchangeRate`).then(res => {\r\n                console.log(res)\r\n                if (res.data.code === 200) {\r\n                    console.log(res.data.rates)\r\n                    this.CNYToUSD = res.data.rates.CNYToUSD;\r\n                    this.rate = `人民币到美元:  ${this.CNYToUSD}`;\r\n                    this.loading = false;\r\n                } else {\r\n                    this.loading = false;\r\n                    this.rate = '获取汇率失败';\r\n                }\r\n                console.log(this.CNYToUSD)\r\n            }).catch((e) => {\r\n                console.log(e)\r\n            })\r\n        },\r\n        selectPrice(price) {\r\n            this.price = price;\r\n        },\r\n        requirePayment() {\r\n            console.log('account:', localStorage.getItem('account'))\r\n            const apiBaseUrl = process.env.VUE_APP_BACKEND_BASE_URL;\r\n            const intervalId = setInterval(() => {\r\n                axios.post(`${apiBaseUrl}/queryPayment`, {\r\n                        account: localStorage.getItem('account'),\r\n                        out_trade_no: this.out_trade_no\r\n                    })\r\n                    .then(res => {\r\n                        console.log(res.data.status)\r\n                        if (res.data.code === 10001) {\r\n                            this.tip = \"交易成功\"\r\n                            this.showBackButton = true;\r\n                            \r\n\r\n                            clearInterval(intervalId);\r\n                            this.$message({\r\n                                type: 'success',\r\n                                message: '交易成功'\r\n                            });\r\n                        } else if (res.data.code === 20002) {\r\n\r\n                        } else if (res.data.code === 30003) {\r\n                            this.isLoading = false;\r\n                            this.$message({\r\n                                type: 'error',\r\n                                message: '未付款，交易关闭'\r\n                            });\r\n                        }\r\n                    })\r\n                    .catch(error => {\r\n                        console.error(\"请求失败\", error);\r\n                    });\r\n            }, 2000); // 每2秒调用一次\r\n        },\r\n        beforeDestroy() {\r\n            clearInterval(intervalId); // 确保组件销毁时清理定时任务\r\n        },\r\n        submitOrder() {\r\n            this.out_trade_no = new Date().getTime();\r\n            if (this.price === 0) {\r\n                this.$message({\r\n                    type: \"error\",\r\n                    message: \"请选择充值数额\"\r\n                })\r\n                return;\r\n            }\r\n            let data = {\r\n                out_trade_no: this.out_trade_no,\r\n                total_amount: this.price,\r\n                subject: '充值'\r\n            }\r\n            console.log('submits')\r\n            const apiBaseUrl = process.env.VUE_APP_BACKEND_BASE_URL;\r\n            axios.post(`${apiBaseUrl}/payment`, data).then(res => {\r\n                this.isLoading = true\r\n                this.urlContent = res.data.url\r\n                console.log(this.urlContent)\r\n                window.open(this.urlContent, '_blank')\r\n                this.requirePayment();\r\n            }).catch(e => {\r\n                console.log(e)\r\n            })\r\n        }\r\n    },\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n/* 蒙版的样式 */\r\n.overlay {\r\n    display: flex;\r\n    flex-direction: column;\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: rgba(0, 0, 0, 0.5);\r\n    /* 半透明黑色背景 */\r\n    z-index: 9999;\r\n    /* 保证蒙版位于最上层 */\r\n    justify-content: center;\r\n    align-items: center;\r\n    color: white;\r\n    font-size: 24px;\r\n    font-family: Arial, sans-serif;\r\n}\r\n\r\n.gasRecharge-container {\r\n    position: relative;\r\n    display: flex;\r\n    flex-direction: column;\r\n    /* justify-content: center; */\r\n    align-items: center;\r\n    height: 100vh;\r\n    width: 100vw;\r\n    /* background-image: linear-gradient(to top, #bdc2e8 0%, #bdc2e8 1%, #e6dee9 80%); */\r\n    background-image: linear-gradient(to top, #e25323 0%, rgba(255, 201, 163, 0.821) 100%);\r\n    ;\r\n}\r\n\r\n.gasRecharge-guideBox {\r\n    margin-top: 50px;\r\n    margin-left: 50px;\r\n    /* border: 1px solid green; */\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 10px;\r\n}\r\n\r\n.gasRecharge-title {\r\n    align-self: flex-start;\r\n    color: rgb(245, 240, 232);\r\n    font-weight: bold;\r\n    font-size: 2em;\r\n}\r\n\r\n.gasRecharge-box {\r\n    padding: 30px;\r\n    /* border:1px solid red; */\r\n    margin-left: 50px;\r\n    width: 90%;\r\n    margin-top: 30px;\r\n    /*侧边栏删除记得改*/\r\n    background-color: #fff;\r\n    border-radius: 10px;\r\n    box-shadow: 0 0 2px rgba(0, 0, 0, 0.2);\r\n    display: flex;\r\n    gap: 20px;\r\n    flex-direction: column;\r\n}\r\n\r\n.gasRecharge-priceBox {\r\n    /* border:1px solid red; */\r\n    display: flex;\r\n    gap: 40px;\r\n    margin-left: 50px;\r\n    width: 85%\r\n}\r\n\r\n.priceBT {\r\n    flex: 1\r\n}\r\n\r\n.gasRecharge-currentPrice {\r\n    padding: 25px;\r\n    /* border:1px solid red; */\r\n    margin-left: 50px;\r\n    width: 90%;\r\n    margin-top: 30px;\r\n    /*侧边栏删除记得改*/\r\n    background-color: #fff;\r\n    border-radius: 10px;\r\n    box-shadow: 0 0 2px rgba(0, 0, 0, 0.2);\r\n    display: flex;\r\n    flex-direction: column;\r\n}\r\n</style>\r\n"],"mappings":"AAsGA,OAAAA,KAAA;AACA;EACA;EACAC,QAAA;IACAC,OAAA,CAAAC,GAAA,aAAAC,YAAA,CAAAC,OAAA;IACA;EACA;EACAC,KAAA;IACA;MACAC,GAAA;MACAC,OAAA;MACAC,IAAA;MACAC,KAAA;MACAC,UAAA;MACAC,SAAA;MACAC,YAAA;MACAC,MAAA;MACAC,cAAA;IACA;EACA;EACAC,OAAA;IACAC,MAAA;MACA,KAAAL,SAAA;MACA,KAAAL,GAAA;MACA,KAAAQ,cAAA;IACA;IACAG,gBAAA;MACA,MAAAC,UAAA,GAAAC,OAAA,CAAAC,GAAA,CAAAC,wBAAA;MACAtB,KAAA,CAAAuB,GAAA,IAAAJ,UAAA,oBAAAK,IAAA,CAAAC,GAAA;QACAvB,OAAA,CAAAC,GAAA,CAAAsB,GAAA;QACA,IAAAA,GAAA,CAAAnB,IAAA,CAAAoB,IAAA;UACAxB,OAAA,CAAAC,GAAA,CAAAsB,GAAA,CAAAnB,IAAA,CAAAqB,KAAA;UACA,KAAAC,QAAA,GAAAH,GAAA,CAAAnB,IAAA,CAAAqB,KAAA,CAAAC,QAAA;UACA,KAAAnB,IAAA,oBAAAmB,QAAA;UACA,KAAApB,OAAA;QACA;UACA,KAAAA,OAAA;UACA,KAAAC,IAAA;QACA;QACAP,OAAA,CAAAC,GAAA,MAAAyB,QAAA;MACA,GAAAC,KAAA,CAAAC,CAAA;QACA5B,OAAA,CAAAC,GAAA,CAAA2B,CAAA;MACA;IACA;IACAC,YAAArB,KAAA;MACA,KAAAA,KAAA,GAAAA,KAAA;IACA;IACAsB,eAAA;MACA9B,OAAA,CAAAC,GAAA,aAAAC,YAAA,CAAAC,OAAA;MACA,MAAAc,UAAA,GAAAC,OAAA,CAAAC,GAAA,CAAAC,wBAAA;MACA,MAAAW,UAAA,GAAAC,WAAA;QACAlC,KAAA,CAAAmC,IAAA,IAAAhB,UAAA;UACAiB,OAAA,EAAAhC,YAAA,CAAAC,OAAA;UACAQ,YAAA,OAAAA;QACA,GACAW,IAAA,CAAAC,GAAA;UACAvB,OAAA,CAAAC,GAAA,CAAAsB,GAAA,CAAAnB,IAAA,CAAA+B,MAAA;UACA,IAAAZ,GAAA,CAAAnB,IAAA,CAAAoB,IAAA;YACA,KAAAnB,GAAA;YACA,KAAAQ,cAAA;YAGAuB,aAAA,CAAAL,UAAA;YACA,KAAAM,QAAA;cACAC,IAAA;cACAC,OAAA;YACA;UACA,WAAAhB,GAAA,CAAAnB,IAAA,CAAAoB,IAAA,aAEA,WAAAD,GAAA,CAAAnB,IAAA,CAAAoB,IAAA;YACA,KAAAd,SAAA;YACA,KAAA2B,QAAA;cACAC,IAAA;cACAC,OAAA;YACA;UACA;QACA,GACAZ,KAAA,CAAAa,KAAA;UACAxC,OAAA,CAAAwC,KAAA,SAAAA,KAAA;QACA;MACA;IACA;IACAC,cAAA;MACAL,aAAA,CAAAL,UAAA;IACA;IACAW,YAAA;MACA,KAAA/B,YAAA,OAAAgC,IAAA,GAAAC,OAAA;MACA,SAAApC,KAAA;QACA,KAAA6B,QAAA;UACAC,IAAA;UACAC,OAAA;QACA;QACA;MACA;MACA,IAAAnC,IAAA;QACAO,YAAA,OAAAA,YAAA;QACAkC,YAAA,OAAArC,KAAA;QACAsC,OAAA;MACA;MACA9C,OAAA,CAAAC,GAAA;MACA,MAAAgB,UAAA,GAAAC,OAAA,CAAAC,GAAA,CAAAC,wBAAA;MACAtB,KAAA,CAAAmC,IAAA,IAAAhB,UAAA,YAAAb,IAAA,EAAAkB,IAAA,CAAAC,GAAA;QACA,KAAAb,SAAA;QACA,KAAAD,UAAA,GAAAc,GAAA,CAAAnB,IAAA,CAAA2C,GAAA;QACA/C,OAAA,CAAAC,GAAA,MAAAQ,UAAA;QACAuC,MAAA,CAAAC,IAAA,MAAAxC,UAAA;QACA,KAAAqB,cAAA;MACA,GAAAH,KAAA,CAAAC,CAAA;QACA5B,OAAA,CAAAC,GAAA,CAAA2B,CAAA;MACA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}