{"ast":null,"code":"/*\nThis file is part of web3.js.\n\nweb3.js is free software: you can redistribute it and/or modify\nit under the terms of the GNU Lesser General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nweb3.js is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Lesser General Public License for more details.\n\nYou should have received a copy of the GNU Lesser General Public License\nalong with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\nimport { toChecksumAddress, leftPad, hexToNumber } from 'web3-utils';\nimport { isAddress } from 'web3-validator';\nimport { InvalidAddressError } from 'web3-errors';\n/**\n * Converts Ethereum addresses to IBAN or BBAN addresses and vice versa.\n */\nexport class Iban {\n  /**\n   * Construct a direct or indirect IBAN that has conversion methods and validity checks.\n   * If the provided string was not of either the length of a direct IBAN (34 or 35),\n   * nor the length of an indirect IBAN (20), an Error will be thrown ('Invalid IBAN was provided').\n   *\n   * @param iban - a Direct or an Indirect IBAN\n   * @returns - Iban instance\n   *\n   * @example\n   * ```ts\n   * const iban = new web3.eth.Iban(\"XE7338O073KYGTWWZN0F2WZ0R8PX5ZPPZS\");\n   * > Iban { _iban: 'XE7338O073KYGTWWZN0F2WZ0R8PX5ZPPZS' }\n   * ```\n   */\n  constructor(iban) {\n    /**\n     * This method should be used to create the equivalent ethereum address for the early provided Direct IBAN address.\n     * If the provided string was not a direct IBAN (has the length of 34 or 35), an Error will be thrown:\n     * ('Iban is indirect and cannot be converted. Must be length of 34 or 35').\n     * Note: this is also available as a static method.\n     *\n     * @return the equivalent ethereum address\n     *\n     * @example\n     * ```ts\n     * const iban = new web3.eth.Iban(\"XE7338O073KYGTWWZN0F2WZ0R8PX5ZPPZS\");\n     * iban.toAddress();\n     * > \"0x00c5496aEe77C1bA1f0854206A26DdA82a81D6D8\"\n     * ```\n     */\n    this.toAddress = () => {\n      if (this.isDirect()) {\n        // check if Iban can be converted to an address\n        const base36 = this._iban.slice(4);\n        const parsedBigInt = Iban._parseInt(base36, 36); // convert the base36 string to a bigint\n        const paddedBigInt = leftPad(parsedBigInt, 40);\n        return toChecksumAddress(paddedBigInt);\n      }\n      throw new Error('Iban is indirect and cannot be converted. Must be length of 34 or 35');\n    };\n    if (Iban.isIndirect(iban) || Iban.isDirect(iban)) {\n      this._iban = iban;\n    } else {\n      throw new Error('Invalid IBAN was provided');\n    }\n  }\n  /**\n   * A static method that checks if an IBAN is Direct.\n   * It actually check the length of the provided variable and, only if it is 34 or 35, it returns true.\n   * Note: this is also available as a method at an Iban instance.\n   * @param iban - an IBAN to be checked\n   * @returns - `true` if the provided `iban` is a Direct IBAN, and `false` otherwise.\n   *\n   * @example\n   * ```ts\n   * web3.eth.Iban.isDirect(\"XE81ETHXREGGAVOFYORK\");\n   * > false\n   * ```\n   */\n  static isDirect(iban) {\n    return iban.length === 34 || iban.length === 35;\n  }\n  /**\n   * An instance method that checks if iban number is Direct.\n   * It actually check the length of the provided variable and, only if it is 34 or 35, it returns true.\n   * Note: this is also available as a static method.\n   * @param iban - an IBAN to be checked\n   * @returns - `true` if the provided `iban` is a Direct IBAN, and `false` otherwise.\n   *\n   * @example\n   * ```ts\n   * const iban = new web3.eth.Iban(\"XE81ETHXREGGAVOFYORK\");\n   * iban.isDirect();\n   * > false\n   * ```\n   */\n  isDirect() {\n    return Iban.isDirect(this._iban);\n  }\n  /**\n   * A static method that checks if an IBAN is Indirect.\n   * It actually check the length of the provided variable and, only if it is 20, it returns true.\n   * Note: this is also available as a method at an Iban instance.\n   * @param iban - an IBAN to be checked\n   * @returns - `true` if the provided `iban` is an Indirect IBAN, and `false` otherwise.\n   *\n   * @example\n   * ```ts\n   * web3.eth.Iban.isIndirect(\"XE81ETHXREGGAVOFYORK\");\n   * > true\n   * ```\n   */\n  static isIndirect(iban) {\n    return iban.length === 20;\n  }\n  /**\n   * check if iban number if indirect\n   * It actually check the length of the provided variable and, only if it is 20, it returns true.\n   * Note: this is also available as a static method.\n   * @param iban - an IBAN to be checked\n   * @returns - `true` if the provided `iban` is an Indirect IBAN, and `false` otherwise.\n   *\n   * @example\n   * ```ts\n   * const iban = new web3.eth.Iban(\"XE81ETHXREGGAVOFYORK\");\n   * iban.isIndirect();\n   * > true\n   * ```\n   */\n  isIndirect() {\n    return Iban.isIndirect(this._iban);\n  }\n  /**\n   * This method could be used to check if a given string is valid IBAN object.\n   * Note: this is also available as a method at an Iban instance.\n   *\n   * @param iban - a string to be checked if it is in IBAN\n   * @returns - true if it is valid IBAN\n   *\n   * @example\n   * ```ts\n   * web3.eth.Iban.isValid(\"XE81ETHXREGGAVOFYORK\");\n   * > true\n   *\n   * web3.eth.Iban.isValid(\"XE82ETHXREGGAVOFYORK\");\n   * > false // because the checksum is incorrect\n   * ```\n   */\n  static isValid(iban) {\n    return /^XE[0-9]{2}(ETH[0-9A-Z]{13}|[0-9A-Z]{30,31})$/.test(iban) && Iban._mod9710(Iban._iso13616Prepare(iban)) === 1;\n  }\n  /**\n   * Should be called to check if the early provided IBAN is correct.\n   * Note: this is also available as a static method.\n   *\n   * @example\n   * ```ts\n   * const iban = new web3.eth.Iban(\"XE81ETHXREGGAVOFYORK\");\n   * iban.isValid();\n   * > true\n   *\n   * const iban = new web3.eth.Iban(\"XE82ETHXREGGAVOFYORK\");\n   * iban.isValid();\n   * > false // because the checksum is incorrect\n   * ```\n   */\n  isValid() {\n    return Iban.isValid(this._iban);\n  }\n  /**\n   * Convert the passed BBAN to an IBAN for this country specification.\n   * Please note that <i>\"generation of the IBAN shall be the exclusive responsibility of the bank/branch servicing the account\"</i>.\n   * This method implements the preferred algorithm described in http://en.wikipedia.org/wiki/International_Bank_Account_Number#Generating_IBAN_check_digits\n   *\n   * @param bban - the BBAN to convert to IBAN\n   * @returns an Iban class instance that holds the equivalent IBAN\n   *\n   * @example\n   * ```ts\n   * web3.eth.Iban.fromBban('ETHXREGGAVOFYORK');\n   * > Iban {_iban: \"XE7338O073KYGTWWZN0F2WZ0R8PX5ZPPZS\"}\n   * ```\n   */\n  static fromBban(bban) {\n    const countryCode = 'XE';\n    const remainder = this._mod9710(this._iso13616Prepare(`${countryCode}00${bban}`));\n    const checkDigit = `0${(98 - remainder).toString()}`.slice(-2);\n    return new Iban(`${countryCode}${checkDigit}${bban}`);\n  }\n  /**\n   * Should be used to create IBAN object for given institution and identifier\n   *\n   * @param options - an object holds the `institution` and the `identifier` which will be composed to create an `Iban` object from.\n   * @returns an Iban class instance that holds the equivalent IBAN\n   *\n   * @example\n   * ```ts\n   * web3.eth.Iban.createIndirect({\n   *     institution: \"XREG\",\n   *     identifier: \"GAVOFYORK\"\n   * });\n   * > Iban {_iban: \"XE7338O073KYGTWWZN0F2WZ0R8PX5ZPPZS\"}\n   * ```\n   */\n  static createIndirect(options) {\n    return Iban.fromBban(`ETH${options.institution}${options.identifier}`);\n  }\n  /**\n   * This method should be used to create iban object from an Ethereum address.\n   *\n   * @param address - an Ethereum address\n   * @returns an Iban class instance that holds the equivalent IBAN\n   *\n   * @example\n   * ```ts\n   * web3.eth.Iban.fromAddress(\"0x00c5496aEe77C1bA1f0854206A26DdA82a81D6D8\");\n   * > Iban {_iban: \"XE7338O073KYGTWWZN0F2WZ0R8PX5ZPPZS\"}\n   * ```\n   */\n  static fromAddress(address) {\n    if (!isAddress(address)) {\n      throw new InvalidAddressError(address);\n    }\n    const num = BigInt(hexToNumber(address));\n    const base36 = num.toString(36);\n    const padded = leftPad(base36, 15);\n    return Iban.fromBban(padded.toUpperCase());\n  }\n  /**\n   * This method should be used to create IBAN address from an Ethereum address\n   *\n   * @param address - an Ethereum address\n   * @return the equivalent IBAN address\n   *\n   * @example\n   * ```ts\n   * web3.eth.Iban.toIban(\"0x00c5496aEe77C1bA1f0854206A26DdA82a81D6D8\");\n   * > \"XE7338O073KYGTWWZN0F2WZ0R8PX5ZPPZS\"\n   * ```\n   */\n  static toIban(address) {\n    return Iban.fromAddress(address).toString();\n  }\n  /**\n   * Should be called to get client identifier within institution\n   *\n   * @return the client of the IBAN instance.\n   *\n   * @example\n   * ```ts\n   * const iban = new web3.eth.Iban(\"XE81ETHXREGGAVOFYORK\");\n   * iban.client();\n   * > 'GAVOFYORK'\n   * ```\n   */\n  client() {\n    return this.isIndirect() ? this._iban.slice(11) : '';\n  }\n  /**\n   * Returns the IBAN checksum of the early provided IBAN\n   *\n   * @example\n   * ```ts\n   * const iban = new web3.eth.Iban(\"XE81ETHXREGGAVOFYORK\");\n   * iban.checksum();\n   * > \"81\"\n   * ```\n   *\n   */\n  checksum() {\n    return this._iban.slice(2, 4);\n  }\n  /**\n   * Returns institution identifier from the early provided  IBAN\n   *\n   * @example\n   * ```ts\n   * const iban = new web3.eth.Iban(\"XE81ETHXREGGAVOFYORK\");\n   * iban.institution();\n   * > 'XREG'\n   * ```\n   */\n  institution() {\n    return this.isIndirect() ? this._iban.slice(7, 11) : '';\n  }\n  /**\n   * Simply returns the early provided IBAN\n   *\n   * @example\n   * ```ts\n   * const iban = new web3.eth.Iban('XE7338O073KYGTWWZN0F2WZ0R8PX5ZPPZS');\n   * iban.toString();\n   * > 'XE7338O073KYGTWWZN0F2WZ0R8PX5ZPPZS'\n   * ```\n   */\n  toString() {\n    return this._iban;\n  }\n}\n/**\n * Prepare an IBAN for mod 97 computation by moving the first 4 chars to the end and transforming the letters to\n * numbers (A = 10, B = 11, ..., Z = 35), as specified in ISO13616.\n */\nIban._iso13616Prepare = iban => {\n  const A = 'A'.charCodeAt(0);\n  const Z = 'Z'.charCodeAt(0);\n  const upperIban = iban.toUpperCase();\n  const modifiedIban = `${upperIban.slice(4)}${upperIban.slice(0, 4)}`;\n  return modifiedIban.split('').map(n => {\n    const code = n.charCodeAt(0);\n    if (code >= A && code <= Z) {\n      // A = 10, B = 11, ... Z = 35\n      return code - A + 10;\n    }\n    return n;\n  }).join('');\n};\n/**\n * return the bigint of the given string with the specified base\n */\nIban._parseInt = (str, base) => [...str].reduce((acc, curr) => BigInt(parseInt(curr, base)) + BigInt(base) * acc, BigInt(0));\n/**\n * Calculates the MOD 97 10 of the passed IBAN as specified in ISO7064.\n */\nIban._mod9710 = iban => {\n  let remainder = iban;\n  let block;\n  while (remainder.length > 2) {\n    block = remainder.slice(0, 9);\n    remainder = `${(parseInt(block, 10) % 97).toString()}${remainder.slice(block.length)}`;\n  }\n  return parseInt(remainder, 10) % 97;\n};\n/**\n * This method should be used to create an ethereum address from a Direct IBAN address.\n * If the provided string was not a direct IBAN (has the length of 34 or 35), an Error will be thrown:\n * ('Iban is indirect and cannot be converted. Must be length of 34 or 35').\n * Note: this is also available as a method at an Iban instance.\n *\n * @param iban - a Direct IBAN address\n * @return the equivalent ethereum address\n *\n * @example\n * ```ts\n * web3.eth.Iban.toAddress(\"XE7338O073KYGTWWZN0F2WZ0R8PX5ZPPZS\");\n * > \"0x00c5496aEe77C1bA1f0854206A26DdA82a81D6D8\"\n * ```\n */\nIban.toAddress = iban => {\n  const ibanObject = new Iban(iban);\n  return ibanObject.toAddress();\n};","map":{"version":3,"names":["toChecksumAddress","leftPad","hexToNumber","isAddress","InvalidAddressError","Iban","constructor","iban","toAddress","isDirect","base36","_iban","slice","parsedBigInt","_parseInt","paddedBigInt","Error","isIndirect","length","isValid","test","_mod9710","_iso13616Prepare","fromBban","bban","countryCode","remainder","checkDigit","toString","createIndirect","options","institution","identifier","fromAddress","address","num","BigInt","padded","toUpperCase","toIban","client","checksum","A","charCodeAt","Z","upperIban","modifiedIban","split","map","n","code","join","str","base","reduce","acc","curr","parseInt","block","ibanObject"],"sources":["../../src/iban.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}