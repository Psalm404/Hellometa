{"ast":null,"code":"import contract from \"./contract\";\nimport { getAccountAddr } from \"./getAccountAddr\";\nimport Web3 from \"web3\";\nasync function buyToken(tokenId, nftPrice) {\n  try {\n    if (!contract) {\n      console.error('合约实例未初始化');\n      return null;\n    }\n\n    // 确保传入的tokenId, nftPrice是有效的\n    if (!tokenId || !nftPrice) {\n      console.error('参数无效');\n      return null;\n    }\n    const nftPriceWei = Web3.utils.toWei(nftPrice.toString(), 'ether');\n    const address = await getAccountAddr();\n    const gasEstimate = await contract.methods.buyNFT(tokenId).estimateGas({\n      from: address,\n      value: nftPriceWei // 发送的以太坊金额（以 wei 为单位）\n    });\n    console.log(gasEstimate);\n    // 调用合约的buyNFT函数\n    const tx = await contract.methods.buyNFT(tokenId).send({\n      from: address,\n      // 交易发起者的地址\n      value: nftPriceWei.toString(),\n      // 发送wei的金额\n      gas: gasEstimate\n    });\n\n    // 交易成功后，打印交易哈希\n    console.log('购买成功，交易哈希:', tx.transactionHash);\n    return tx.transactionHash; // 返回交易哈希，以便于后续处理\n  } catch (error) {\n    console.error('购买NFT失败', error);\n    return null;\n  }\n}\nexport default buyToken;","map":{"version":3,"names":["contract","getAccountAddr","Web3","buyToken","tokenId","nftPrice","console","error","nftPriceWei","utils","toWei","toString","address","gasEstimate","methods","buyNFT","estimateGas","from","value","log","tx","send","gas","transactionHash"],"sources":["/Users/acciomac/Desktop/repo/Hellometa/src/commons/buyToken.js"],"sourcesContent":["import contract from \"./contract\";\nimport { getAccountAddr } from \"./getAccountAddr\";\nimport Web3 from \"web3\";\n\nasync function buyToken(tokenId, nftPrice) {\n    try {\n        if (!contract) {\n            console.error('合约实例未初始化');\n            return null;\n        }\n\n        // 确保传入的tokenId, nftPrice是有效的\n        if (!tokenId || !nftPrice) {\n            console.error('参数无效');\n            return null;\n        }\n        \n        const nftPriceWei = Web3.utils.toWei(nftPrice.toString(), 'ether');\n        const address = await getAccountAddr();\n        const gasEstimate = await contract.methods.buyNFT(tokenId).estimateGas({\n            from: address, \n            value: nftPriceWei, // 发送的以太坊金额（以 wei 为单位）\n        });\n        console.log(gasEstimate)\n        // 调用合约的buyNFT函数\n        const tx = await contract.methods.buyNFT(tokenId).send({\n            from: address, // 交易发起者的地址\n            value: nftPriceWei.toString(), // 发送wei的金额\n            gas: gasEstimate\n        });\n\n        // 交易成功后，打印交易哈希\n        console.log('购买成功，交易哈希:', tx.transactionHash);\n        return tx.transactionHash; // 返回交易哈希，以便于后续处理\n    } catch (error) {\n        console.error('购买NFT失败', error);\n        return null;\n    }\n}\n\nexport default buyToken;"],"mappings":"AAAA,OAAOA,QAAQ,MAAM,YAAY;AACjC,SAASC,cAAc,QAAQ,kBAAkB;AACjD,OAAOC,IAAI,MAAM,MAAM;AAEvB,eAAeC,QAAQA,CAACC,OAAO,EAAEC,QAAQ,EAAE;EACvC,IAAI;IACA,IAAI,CAACL,QAAQ,EAAE;MACXM,OAAO,CAACC,KAAK,CAAC,UAAU,CAAC;MACzB,OAAO,IAAI;IACf;;IAEA;IACA,IAAI,CAACH,OAAO,IAAI,CAACC,QAAQ,EAAE;MACvBC,OAAO,CAACC,KAAK,CAAC,MAAM,CAAC;MACrB,OAAO,IAAI;IACf;IAEA,MAAMC,WAAW,GAAGN,IAAI,CAACO,KAAK,CAACC,KAAK,CAACL,QAAQ,CAACM,QAAQ,CAAC,CAAC,EAAE,OAAO,CAAC;IAClE,MAAMC,OAAO,GAAG,MAAMX,cAAc,CAAC,CAAC;IACtC,MAAMY,WAAW,GAAG,MAAMb,QAAQ,CAACc,OAAO,CAACC,MAAM,CAACX,OAAO,CAAC,CAACY,WAAW,CAAC;MACnEC,IAAI,EAAEL,OAAO;MACbM,KAAK,EAAEV,WAAW,CAAE;IACxB,CAAC,CAAC;IACFF,OAAO,CAACa,GAAG,CAACN,WAAW,CAAC;IACxB;IACA,MAAMO,EAAE,GAAG,MAAMpB,QAAQ,CAACc,OAAO,CAACC,MAAM,CAACX,OAAO,CAAC,CAACiB,IAAI,CAAC;MACnDJ,IAAI,EAAEL,OAAO;MAAE;MACfM,KAAK,EAAEV,WAAW,CAACG,QAAQ,CAAC,CAAC;MAAE;MAC/BW,GAAG,EAAET;IACT,CAAC,CAAC;;IAEF;IACAP,OAAO,CAACa,GAAG,CAAC,YAAY,EAAEC,EAAE,CAACG,eAAe,CAAC;IAC7C,OAAOH,EAAE,CAACG,eAAe,CAAC,CAAC;EAC/B,CAAC,CAAC,OAAOhB,KAAK,EAAE;IACZD,OAAO,CAACC,KAAK,CAAC,SAAS,EAAEA,KAAK,CAAC;IAC/B,OAAO,IAAI;EACf;AACJ;AAEA,eAAeJ,QAAQ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}