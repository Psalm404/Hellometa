{"ast":null,"code":"/*\nThis file is part of web3.js.\n\nweb3.js is free software: you can redistribute it and/or modify\nit under the terms of the GNU Lesser General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nweb3.js is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Lesser General Public License for more details.\n\nYou should have received a copy of the GNU Lesser General Public License\nalong with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nimport { Web3ContractError } from 'web3-errors';\nimport { sendTransaction } from 'web3-eth';\nimport { DEFAULT_RETURN_FORMAT } from 'web3-types';\nimport { format } from 'web3-utils';\nimport { isNullish } from 'web3-validator';\nimport { decodeMethodParams, encodeMethodABI } from './encoding.js';\nimport { getSendTxParams } from './utils.js';\n/*\n * This class is only supposed to be used for the return of `new Contract(...).deploy(...)` method.\n */\nexport class DeployerMethodClass {\n  constructor(\n  // eslint-disable-next-line no-use-before-define\n  parent, deployOptions) {\n    this.parent = parent;\n    this.deployOptions = deployOptions;\n    const {\n      args,\n      abi,\n      contractOptions,\n      deployData\n    } = this.calculateDeployParams();\n    this.args = args;\n    this.constructorAbi = abi;\n    this.contractOptions = contractOptions;\n    this.deployData = deployData;\n  }\n  _contractMethodDeploySend(tx) {\n    // eslint-disable-next-line no-use-before-define\n    const returnTxOptions = {\n      transactionResolver: receipt => {\n        if (receipt.status === BigInt(0)) {\n          throw new Web3ContractError(\"code couldn't be stored\", receipt);\n        }\n        const newContract = this.parent.clone();\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        newContract.options.address = receipt.contractAddress;\n        return newContract;\n      },\n      contractAbi: this.parent.options.jsonInterface,\n      // TODO Should make this configurable by the user\n      checkRevertBeforeSending: false\n    };\n    return isNullish(this.parent.getTransactionMiddleware()) ? sendTransaction(this.parent, tx, this.parent.defaultReturnFormat, returnTxOptions) // not calling this with undefined Middleware because it will not break if Eth package is not updated\n    : sendTransaction(this.parent, tx, this.parent.defaultReturnFormat, returnTxOptions, this.parent.getTransactionMiddleware());\n  }\n  send(options) {\n    const modifiedOptions = Object.assign({}, options);\n    const tx = this.populateTransaction(modifiedOptions);\n    return this._contractMethodDeploySend(tx);\n  }\n  populateTransaction(txOptions) {\n    var _a, _b;\n    const modifiedContractOptions = Object.assign(Object.assign({}, this.contractOptions), {\n      from: (_b = (_a = this.contractOptions.from) !== null && _a !== void 0 ? _a : this.parent.defaultAccount) !== null && _b !== void 0 ? _b : undefined\n    });\n    // args, abi, contractOptions, deployData\n    const tx = getSendTxParams({\n      abi: this.constructorAbi,\n      params: this.args,\n      options: Object.assign(Object.assign({}, txOptions), {\n        dataInputFill: this.parent.contractDataInputFill\n      }),\n      contractOptions: modifiedContractOptions\n    });\n    // @ts-expect-error remove unnecessary field\n    if (tx.dataInputFill) {\n      // @ts-expect-error remove unnecessary field\n      delete tx.dataInputFill;\n    }\n    return tx;\n  }\n  calculateDeployParams() {\n    var _a, _b, _c, _d, _e, _f;\n    let abi = this.parent.options.jsonInterface.find(j => j.type === 'constructor');\n    if (!abi) {\n      abi = {\n        type: 'constructor',\n        stateMutability: ''\n      };\n    }\n    const _input = format({\n      format: 'bytes'\n    }, (_b = (_a = this.deployOptions) === null || _a === void 0 ? void 0 : _a.input) !== null && _b !== void 0 ? _b : this.parent.options.input, DEFAULT_RETURN_FORMAT);\n    const _data = format({\n      format: 'bytes'\n    }, (_d = (_c = this.deployOptions) === null || _c === void 0 ? void 0 : _c.data) !== null && _d !== void 0 ? _d : this.parent.options.data, DEFAULT_RETURN_FORMAT);\n    if ((!_input || _input.trim() === '0x') && (!_data || _data.trim() === '0x')) {\n      throw new Web3ContractError('contract creation without any data provided.');\n    }\n    const args = (_f = (_e = this.deployOptions) === null || _e === void 0 ? void 0 : _e.arguments) !== null && _f !== void 0 ? _f : [];\n    const contractOptions = Object.assign(Object.assign({}, this.parent.options), {\n      input: _input,\n      data: _data\n    });\n    const deployData = _input !== null && _input !== void 0 ? _input : _data;\n    return {\n      args,\n      abi,\n      contractOptions,\n      deployData\n    };\n  }\n  estimateGas(options, returnFormat = this.parent.defaultReturnFormat) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const modifiedOptions = Object.assign({}, options);\n      return this.parent.contractMethodEstimateGas({\n        abi: this.constructorAbi,\n        params: this.args,\n        returnFormat,\n        options: modifiedOptions,\n        contractOptions: this.contractOptions\n      });\n    });\n  }\n  encodeABI() {\n    return encodeMethodABI(this.constructorAbi, this.args, format({\n      format: 'bytes'\n    }, this.deployData, this.parent.defaultReturnFormat));\n  }\n  decodeData(data) {\n    return Object.assign(Object.assign({}, decodeMethodParams(this.constructorAbi, data.replace(this.deployData, ''), false)), {\n      __method__: this.constructorAbi.type\n    });\n  }\n}\n;","map":{"version":3,"names":["Web3ContractError","sendTransaction","DEFAULT_RETURN_FORMAT","format","isNullish","decodeMethodParams","encodeMethodABI","getSendTxParams","DeployerMethodClass","constructor","parent","deployOptions","args","abi","contractOptions","deployData","calculateDeployParams","constructorAbi","_contractMethodDeploySend","tx","returnTxOptions","transactionResolver","receipt","status","BigInt","newContract","clone","options","address","contractAddress","contractAbi","jsonInterface","checkRevertBeforeSending","getTransactionMiddleware","defaultReturnFormat","send","modifiedOptions","Object","assign","populateTransaction","txOptions","modifiedContractOptions","from","_b","_a","defaultAccount","undefined","params","dataInputFill","contractDataInputFill","find","j","type","stateMutability","_input","input","_data","_d","_c","data","trim","_f","_e","arguments","estimateGas","returnFormat","contractMethodEstimateGas","encodeABI","decodeData","replace","__method__"],"sources":["../../src/contract-deployer-method-class.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}